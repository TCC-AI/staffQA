/ ✅ 完整前端：支援對話記憶
<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>昶青物流 客服應對系統</title>
</head>
<body>
  <input id="searchInput" placeholder="輸入問題...">
  <button onclick="performSearch(document.getElementById('searchInput').value)">搜尋</button>
  <div id="result"></div>
  <script>
    const CONFIG = {
      GAS_URL: 'https://script.google.com/macros/s/AKfycbzDApxKloey8iIX0TohMcaO4n7Rd5q_UqBpXUFLEbvp_oeUqvEoK8fivcap5VTXkZk_EQ/exec'
    };
    let chatHistory = [];

    function performSearch(query) {
      if (!query.trim()) return;
      const callbackName = 'cb_' + Date.now();
      const script = document.createElement('script');
      const url = `${CONFIG.GAS_URL}?callback=${callbackName}&action=search&query=${encodeURIComponent(query)}&history=${encodeURIComponent(JSON.stringify(chatHistory))}`;

      window[callbackName] = function(response) {
        delete window[callbackName];
        document.head.removeChild(script);
        if (response.success) {
          chatHistory.push({ role: 'user', content: query });
          chatHistory.push({ role: 'assistant', content: response.answer });
          document.getElementById('result').innerText = response.answer;
        } else {
          document.getElementById('result').innerText = '錯誤：' + response.error;
        }
      };

      script.src = url;
      document.head.appendChild(script);
    }
  </script>
</body>
</html>
